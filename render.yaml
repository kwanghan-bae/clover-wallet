services:
  # 1. Backend API (Kotlin/Spring Boot)
  - type: web
    name: clover-wallet-api
    runtime: docker
    region: singapore
    plan: free
    rootDir: backend
    buildFilter:
      paths:
        - backend/**
        - render.yaml
    envVars:
      - key: SPRING_PROFILES_ACTIVE
        value: prod
      - key: JAVA_OPTS
        value: -XX:+UseContainerSupport -XX:MaxRAMPercentage=75.0
    healthCheckPath: /actuator/health
    autoDeploy: true
    dockerfilePath: Dockerfile
    dockerContext: .

  # 2. Frontend Web (React Native/Expo)
  - type: static
    name: clover-wallet-web
    env: static
    region: singapore
    plan: free
    rootDir: frontend
    buildFilter:
      paths:
        - frontend/**
        - render.yaml
    buildCommand: npm install --legacy-peer-deps && npx expo export --platform web
    publishPath: dist
    autoDeploy: true
    routes:
      - type: rewrite
        source: /*
        destination: /index.html
