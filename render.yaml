services:
  # 1. Backend API (Kotlin/Spring Boot)
  - type: web
    name: clover-wallet-api
    runtime: docker
    region: singapore
    plan: free
    rootDir: backend
    envVars:
      - key: SPRING_PROFILES_ACTIVE
        value: prod
      - key: JAVA_OPTS
        value: -XX:+UseContainerSupport -XX:MaxRAMPercentage=75.0
    healthCheckPath: /actuator/health
    autoDeploy: true
    dockerfilePath: Dockerfile
    dockerContext: .

  # 2. Frontend Web (React Native/Expo)
  - type: static
    name: clover-wallet-web
    env: static
    region: singapore
    plan: free
    
    # 서비스 소스 루트 디렉토리 설정
    rootDir: frontend
    
    # NPM 7 이상의 버전 충돌을 방지하고 Expo Web Export를 실행합니다.
    buildCommand: npm install --legacy-peer-deps && npx expo export --platform web
    
    # Expo 배포용 정적 파일 생성 경로입니다.
    publishPath: dist
    
    # 자동 배포
    autoDeploy: true
    
    # SPA를 위한 라우팅 규칙 (Deep Linking 지원)
    routes:
      - type: rewrite
        source: /*
        destination: /index.html